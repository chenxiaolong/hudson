From 07f5aef1a56ccb1583d0c7cb275a10d37ebff494 Mon Sep 17 00:00:00 2001
From: Xiao-Long Chen <chenxiaolong@cxl.epac.to>
Date: Thu, 12 Sep 2013 23:22:25 -0400
Subject: [PATCH] Add app moving setting to development options

Thanks to:
  maikinho10 - German translations
  blala      - Italian translations

Change-Id: I5fdbc6c46a6ba7f348c0310eb83e96a2784256df
---
 res/values-de/strings.xml                         |  2 ++
 res/values-it/strings.xml                         |  2 ++
 res/values/cm_strings.xml                         |  4 ++++
 res/xml/development_prefs.xml                     |  6 ++++++
 src/com/android/settings/DevelopmentSettings.java | 21 +++++++++++++++++++++
 5 files changed, 35 insertions(+)

diff --git a/res/values-de/strings.xml b/res/values-de/strings.xml
index 04f2b43..c10d708 100644
--- a/res/values-de/strings.xml
+++ b/res/values-de/strings.xml
@@ -2050,4 +2050,6 @@
     <string name="user_image_take_photo" msgid="1280274310152803669">"Foto aufnehmen"</string>
     <string name="user_image_choose_photo" msgid="7940990613897477057">"Foto aus Galerie auswählen"</string>
     <string name="regulatory_info_text" msgid="5623087902354026557"></string>
+    <string name="app_moving">Apps verschieben</string>
+    <string name="app_moving_summary">Aktivieren Sie das Verschieben von Anwendungen auf externe Speichermedien (Neustart nach Änderung der Einstellung)</string>
 </resources>
diff --git a/res/values-it/strings.xml b/res/values-it/strings.xml
index 0931447..3b18c3a 100644
--- a/res/values-it/strings.xml
+++ b/res/values-it/strings.xml
@@ -2046,4 +2046,6 @@
     <string name="user_image_take_photo" msgid="1280274310152803669">"Scatta foto"</string>
     <string name="user_image_choose_photo" msgid="7940990613897477057">"Scegli la foto dalla Galleria"</string>
     <string name="regulatory_info_text" msgid="5623087902354026557"></string>
+    <string name="app_moving">Spostamento apps</string>
+    <string name="app_moving_summary">Abilita lo spostamento delle applicazioni su supporti di memorizzazione esterni (riavvia dopo aver cambiato le impostazioni)</string>
 </resources>
diff --git a/res/values/cm_strings.xml b/res/values/cm_strings.xml
index d01ba2b..87d78d2 100644
--- a/res/values/cm_strings.xml
+++ b/res/values/cm_strings.xml
@@ -484,6 +484,10 @@ two in order to insert additional control points. \'Remove\' deletes the selecte
     <string name="sensors_motors_title">Sensors &amp; motors</string>
     <string name="display_calibration_title">Display calibration</string>
 
+    <!-- App moving settings -->
+    <string name="app_moving">App moving</string>
+    <string name="app_moving_summary">Enable the moving of applications to external storage (reboot after changing setting)</string>
+
     <!-- Setting checkbox summary for displaying USB debugging notification -->
     <string name="adb_notify">USB debugging notify</string>
     <string name="adb_notify_summary">Display a notification when USB debugging is connected</string>
diff --git a/res/xml/development_prefs.xml b/res/xml/development_prefs.xml
index 5c96513..2cfc3fb 100644
--- a/res/xml/development_prefs.xml
+++ b/res/xml/development_prefs.xml
@@ -298,6 +298,12 @@
             android:title="@string/show_all_anrs"
             android:summary="@string/show_all_anrs_summary"/>
 
+        <CheckBoxPreference
+            android:key="app_moving"
+            android:title="@string/app_moving"
+            android:summary="@string/app_moving_summary"
+            android:defaultValue="true"/>
+
      </PreferenceCategory>
 
 </PreferenceScreen>
diff --git a/src/com/android/settings/DevelopmentSettings.java b/src/com/android/settings/DevelopmentSettings.java
index dd32d34..26ce4a5 100644
--- a/src/com/android/settings/DevelopmentSettings.java
+++ b/src/com/android/settings/DevelopmentSettings.java
@@ -68,6 +68,8 @@ import android.widget.TextView;
 
 import dalvik.system.VMRuntime;
 
+import org.cyanogenmod.hardware.AppMovingSettings;
+
 import java.io.File;
 import java.util.ArrayList;
 import java.util.HashSet;
@@ -147,6 +149,8 @@ public class DevelopmentSettings extends RestrictedSettingsFragment
 
     private static final String SHOW_ALL_ANRS_KEY = "show_all_anrs";
 
+    private static final String APP_MOVING = "app_moving";
+
     private static final String TAG_CONFIRM_ENFORCE = "confirm_enforce";
 
     private static final String PACKAGE_MIME_TYPE = "application/vnd.android.package-archive";
@@ -211,6 +215,7 @@ public class DevelopmentSettings extends RestrictedSettingsFragment
     private ListPreference mAppProcessLimit;
 
     private CheckBoxPreference mShowAllANRs;
+    private CheckBoxPreference mAppMoving;
 
     private ListPreference mRootAccess;
     private Object mSelectedRootValue;
@@ -334,6 +339,9 @@ public class DevelopmentSettings extends RestrictedSettingsFragment
         mAllPrefs.add(mShowAllANRs);
         mResetCbPrefs.add(mShowAllANRs);
 
+        mAppMoving = findAndInitCheckboxPref(APP_MOVING);
+        mAppMoving.setChecked(AppMovingSettings.isEnabled());
+
         Preference selectRuntime = findPreference(SELECT_RUNTIME_KEY);
         if (selectRuntime != null) {
             mAllPrefs.add(selectRuntime);
@@ -491,6 +499,8 @@ public class DevelopmentSettings extends RestrictedSettingsFragment
             mEnabledSwitch.setChecked(mLastEnabledState);
             setPrefsEnabledState(mLastEnabledState);
         }
+
+        updateAppMovingOptions();
     }
 
     void updateCheckBox(CheckBoxPreference checkBox, boolean value) {
@@ -549,6 +559,7 @@ public class DevelopmentSettings extends RestrictedSettingsFragment
         updateWifiDisplayCertificationOptions();
         updateRootAccessOptions();
         updateAdvancedRebootOptions();
+        updateAppMovingOptions();
     }
 
     private void resetAdvancedRebootOptions() {
@@ -723,6 +734,14 @@ public class DevelopmentSettings extends RestrictedSettingsFragment
         }
     }
 
+    private void writeAppMovingOptions() {
+        AppMovingSettings.setEnabled(mAppMoving.isChecked());
+    }
+
+    private void updateAppMovingOptions() {
+        mAppMoving.setChecked(AppMovingSettings.isEnabled());
+    }
+
     private void updatePasswordSummary() {
         try {
             if (mBackupManager.hasBackupPassword()) {
@@ -1408,6 +1427,8 @@ public class DevelopmentSettings extends RestrictedSettingsFragment
             writeWifiDisplayCertificationOptions();
         } else if (preference == mAdvancedReboot) {
             writeAdvancedRebootOptions();
+        } else if (preference == mAppMoving) {
+            writeAppMovingOptions();
         } else {
             return super.onPreferenceTreeClick(preferenceScreen, preference);
         }
-- 
1.8.4.2

